<h2>ã‚„è¡Œã®ã‚­ãƒã‚³</h2><ul><li><a href="ãƒ¤ãƒŠã‚®ãƒãƒ„ã‚¿ã‚±.html">ãƒ¤ãƒŠã‚®ãƒãƒ„ã‚¿ã‚±</a></li><li><a href="ãƒ¤ãƒŠã‚®ãƒãƒ„ã‚¿ã‚±ï¼Ÿ.html">ãƒ¤ãƒŠã‚®ãƒãƒ„ã‚¿ã‚±ï¼Ÿ</a></li><li><a href="ãƒ¤ãƒ–ãƒ‹ãƒ¯ã‚¿ã‚±o_ãƒ‹ãƒ¯ã‚¿ã‚±.html">ãƒ¤ãƒ–ãƒ‹ãƒ¯ã‚¿ã‚±orãƒ‹ãƒ¯ã‚¿ã‚±</a></li><li><a href="ãƒ¤ãƒã‚¤ã‚°ãƒ.html">ãƒ¤ãƒã‚¤ã‚°ãƒ</a></li><li><a href="ãƒ¤ãƒã‚¤ã‚°ãƒã®ä»²é–“ï¼Ÿ.html">ãƒ¤ãƒã‚¤ã‚°ãƒã®ä»²é–“ï¼Ÿ</a></li><li><a href="ãƒ¤ãƒãƒ‰ãƒªã‚¿ã‚±ãƒ¢ãƒ‰ã‚­.html">ãƒ¤ãƒãƒ‰ãƒªã‚¿ã‚±ãƒ¢ãƒ‰ã‚­</a></li><li><a href="ãƒ¤ãƒãƒ‰ãƒªã‚¿ã‚±ãƒ¢ãƒ‰ã‚­(ãƒ¨ã‚´ãƒ¬ã‚­ã‚¢ãƒŸã‚¢ã‚·ã‚¤ã‚°ãƒã®å¯èƒ½æ€§æœ‰ã‚Š).html">ãƒ¤ãƒãƒ‰ãƒªã‚¿ã‚±ãƒ¢ãƒ‰ã‚­(ãƒ¨ã‚´ãƒ¬ã‚­ã‚¢ãƒŸã‚¢ã‚·ã‚¤ã‚°ãƒã®å¯èƒ½æ€§æœ‰ã‚Š)</a></li><li><a href="ãƒ¤ãƒãƒ‰ãƒªã‚¿ã‚±ãƒ¢ãƒ‰ã‚­(åºƒç¾©).html">ãƒ¤ãƒãƒ‰ãƒªã‚¿ã‚±ãƒ¢ãƒ‰ã‚­(åºƒç¾©)</a></li><li><a href="ãƒ¤ãƒãƒ‰ãƒªã‚¿ã‚±ãƒ¢ãƒ‰ã‚­ï¼Ÿ.html">ãƒ¤ãƒãƒ‰ãƒªã‚¿ã‚±ãƒ¢ãƒ‰ã‚­ï¼Ÿ</a></li><li><a href="ãƒ¦ã‚­ãƒ©ãƒƒãƒ‘ã‚¿ã‚±.html">ãƒ¦ã‚­ãƒ©ãƒƒãƒ‘ã‚¿ã‚±</a></li></ul><div style='margin-top:40px; text-align:center;'><a href="ã‚è¡Œ.html">ã‚è¡Œ</a> | <a href="ã‹è¡Œ.html">ã‹è¡Œ</a> | <a href="ã•è¡Œ.html">ã•è¡Œ</a> | <a href="ãŸè¡Œ.html">ãŸè¡Œ</a> | <a href="ãªè¡Œ.html">ãªè¡Œ</a> | <a href="ã¯è¡Œ.html">ã¯è¡Œ</a> | <a href="ã¾è¡Œ.html">ã¾è¡Œ</a> | <a href="ã‚„è¡Œ.html">ã‚„è¡Œ</a> | <a href="ã‚‰è¡Œ.html">ã‚‰è¡Œ</a> | <a href="ã‚è¡Œ.html">ã‚è¡Œ</a></div><style>
html, body {
  margin: 0;
  padding: 0;
  overflow-y: hidden;
}
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background:#fafafa;
  color:#333;
  padding:16px;
  box-sizing:border-box;
}

.gallery {
  column-count: 2;
  column-gap: 10px;
  max-width: 900px;
  margin: 0 auto;
  visibility: hidden;
}
.gallery a.gallery-item{
  display: block;
  break-inside: avoid;
  margin-bottom: 10px;
  border-radius: 8px;
  overflow: hidden;
}
.gallery img {
  width: 100%;
  height: auto;
  display: block;
  cursor: zoom-in;
  transition: opacity 0.6s ease, transform 0.6s ease;
  opacity: 0;
  transform: translateY(10px);
}
.gallery img.visible {
  opacity: 1;
  transform: translateY(0);
}

@media (max-width: 480px) {
  .gallery { column-count: 1; }
}
</style>
<link rel="stylesheet" href="./lightgallery/lightgallery-bundle.min.css">
<link rel="stylesheet" href="./lightgallery/lg-thumbnail.css">

<script src="./lightgallery/lightgallery.min.js"></script>
<script src="./lightgallery/lg-zoom.min.js"></script>
<script src="./lightgallery/lg-thumbnail.min.js"></script>
<script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {

  function sendHeight() {
    const height = document.documentElement.scrollHeight;
    window.parent.postMessage({ type:"setHeight", height }, "*");
  }

  // ===== Custom CSS for comment panel & favorites overlay =====
  (function(){
    const style = document.createElement("style");
    style.textContent = `
    .lg-custom-btn {
      font-size: 20px;
      cursor: pointer;
      margin-left: 8px;
    }
    #lg-comment-panel {
      position: fixed;
      right: 0;
      top: 0;
      width: 280px;
      max-width: 80%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      color: #fff;
      z-index: 10000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      padding: 12px;
      box-sizing: border-box;
      font-size: 14px;
    }
    #lg-comment-panel.open {
      transform: translateX(0);
    }
    #lg-comment-panel textarea {
      width: 100%;
      height: calc(100% - 40px);
      resize: none;
      background: rgba(0,0,0,0.3);
      color: #fff;
      border: 1px solid #666;
      padding: 6px;
      box-sizing: border-box;
    }
    #lg-comment-panel .lg-comment-header {
      font-weight: bold;
      margin-bottom: 8px;
    }
    #lg-comment-panel .lg-comment-close {
      position: absolute;
      top: 6px;
      right: 8px;
      cursor: pointer;
      font-size: 18px;
    }
    #lg-favorites-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      z-index: 9999;
      display: none;
      align-items: center;
      justify-content: center;
    }
    #lg-favorites-overlay .lg-fav-inner {
      background: #111;
      padding: 12px;
      max-width: 90vw;
      max-height: 80vh;
      overflow: auto;
      border-radius: 8px;
    }
    #lg-favorites-overlay h3 {
      margin: 0 0 8px;
      color: #fff;
      font-size: 16px;
    }
    #lg-favorites-overlay .lg-fav-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 8px;
    }
    #lg-favorites-overlay .lg-fav-item {
      cursor: pointer;
    }
    #lg-favorites-overlay .lg-fav-item img {
      width: 100%;
      display: block;
      border-radius: 4px;
    }
    #lg-favorites-overlay .lg-fav-empty {
      color: #ccc;
      font-size: 14px;
    }
    `;
    document.head.appendChild(style);
  })();

  // ===== LocalStorage helpers =====
  const LS_FAV = "mushroomFavorites";
  const LS_COM = "mushroomComments";
  const LS_EXIF = "mushroomExifVisible";

  function loadJson(key, def) {
    try {
      const v = localStorage.getItem(key);
      if (!v) return def;
      return JSON.parse(v);
    } catch(e) {
      return def;
    }
  }
  function saveJson(key, val) {
    try {
      localStorage.setItem(key, JSON.stringify(val));
    } catch(e) {}
  }

  let favorites = loadJson(LS_FAV, {});          // { href: true }
  let commentsMap = loadJson(LS_COM, {});        // { href: "..." }
  let exifVisible = loadJson(LS_EXIF, true);     // bool

  // ===== Comment panel DOM =====
  const commentPanel = document.createElement("div");
  commentPanel.id = "lg-comment-panel";
  commentPanel.innerHTML = `
    <div class="lg-comment-header">ã“ã®å†™çœŸã®ãƒ¡ãƒ¢</div>
    <div class="lg-comment-close">Ã—</div>
    <textarea placeholder="ã“ã®ã‚­ãƒã‚³ã®ç‰¹å¾´ã‚„å ´æ‰€ãªã©ã®ãƒ¡ãƒ¢ã‚’æ›¸ã‘ã¾ã™"></textarea>
  `;
  document.body.appendChild(commentPanel);
  const commentTextarea = commentPanel.querySelector("textarea");
  const commentClose = commentPanel.querySelector(".lg-comment-close");
  commentClose.addEventListener("click", () => {
    commentPanel.classList.remove("open");
  });

  // ===== Favorites overlay DOM =====
  const favOverlay = document.createElement("div");
  favOverlay.id = "lg-favorites-overlay";
  favOverlay.innerHTML = `
    <div class="lg-fav-inner">
      <h3>ãŠæ°—ã«å…¥ã‚Šä¸€è¦§</h3>
      <div class="lg-fav-grid"></div>
      <div class="lg-fav-empty" style="display:none;">ã¾ã ãŠæ°—ã«å…¥ã‚ŠãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>
    </div>
  `;
  document.body.appendChild(favOverlay);
  const favGrid = favOverlay.querySelector(".lg-fav-grid");
  const favEmpty = favOverlay.querySelector(".lg-fav-empty");
  favOverlay.addEventListener("click", (e) => {
    if (e.target === favOverlay) {
      favOverlay.style.display = "none";
    }
  });

  const gallery = document.querySelector(".gallery");
  let lgInstance = null;
  let galleryItems = [];
  let hrefToIndex = {};

  if (gallery) {
    const fadeObs = new IntersectionObserver(entries=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add("visible");
          fadeObs.unobserve(e.target);
        }
      });
    }, {threshold:0.1});
    gallery.querySelectorAll("img").forEach(img=>fadeObs.observe(img));

    imagesLoaded(gallery, () => {
      gallery.style.visibility="visible";
      sendHeight();

      galleryItems = Array.from(gallery.querySelectorAll("a.gallery-item"));
      hrefToIndex = {};
      galleryItems.forEach((a, idx) => {
        const href = a.getAttribute("href");
        if (href) hrefToIndex[href] = idx;
      });

      // ===== LightGallery init =====
      lgInstance = lightGallery(gallery, {
        selector: 'a.gallery-item',
        plugins: [lgZoom, lgThumbnail],
        speed: 400,
        download: false,
        zoom: true,
        thumbnail: true
      });

      // ===== Get current href helper =====
      function getCurrentHref() {
        if (!lgInstance || !galleryItems.length) return null;
        const idx = lgInstance.index || 0;
        const a = galleryItems[idx];
        if (!a) return null;
        return a.getAttribute("href");
      }

      // ===== UI sync helpers =====
      function syncHeartButton(btn) {
        const href = getCurrentHref();
        if (!btn || !href) return;
        if (favorites[href]) {
          btn.textContent = "â¤";
          btn.style.color = "#ff4d6a";
        } else {
          btn.textContent = "â™¡";
          btn.style.color = "";
        }
      }

      function syncCommentPanel() {
        const href = getCurrentHref();
        if (!href) return;
        const txt = commentsMap[href] || "";
        commentTextarea.value = txt;
      }

      function saveCurrentComment() {
        const href = getCurrentHref();
        if (!href) return;
        const val = commentTextarea.value || "";
        if (val.trim()) {
          commentsMap[href] = val;
        } else {
          delete commentsMap[href];
        }
        saveJson(LS_COM, commentsMap);
      }

      function syncExifVisibility() {
        const caption = document.querySelector(".lg-sub-html");
        if (!caption) return;
        caption.style.display = exifVisible ? "" : "none";
      }

      function renderFavoritesOverlay() {
        favGrid.innerHTML = "";
        const favHrefs = Object.keys(favorites).filter(h => favorites[h]);
        if (!favHrefs.length) {
          favEmpty.style.display = "block";
          return;
        }
        favEmpty.style.display = "none";
        favHrefs.forEach(href => {
          const idx = hrefToIndex[href];
          if (idx === undefined) return;
          const a = galleryItems[idx];
          if (!a) return;
          const img = a.querySelector("img");
          const thumbSrc = img ? img.getAttribute("src") : href;
          const item = document.createElement("div");
          item.className = "lg-fav-item";
          item.dataset.href = href;
          item.innerHTML = `<img src="${thumbSrc}" alt="">`;
          favGrid.appendChild(item);
        });
      }

      favGrid.addEventListener("click", (e) => {
        const item = e.target.closest(".lg-fav-item");
        if (!item) return;
        const href = item.dataset.href;
        favOverlay.style.display = "none";
        if (href && hrefToIndex[href] != null && lgInstance) {
          const idx = hrefToIndex[href];
          try {
            lgInstance.slide(idx);
          } catch(e) {}
        }
      });

      // ===== Add custom toolbar buttons after open =====
      lgInstance.on("lgAfterOpen", () => {
        const toolbar = document.querySelector(".lg-toolbar");
        if (!toolbar) return;

        // Avoid duplicate buttons
        if (!toolbar.querySelector(".lg-custom-heart")) {
          const heartBtn = document.createElement("button");
          heartBtn.className = "lg-icon lg-custom-btn lg-custom-heart";
          heartBtn.title = "ãŠæ°—ã«å…¥ã‚Š";
          toolbar.appendChild(heartBtn);
          heartBtn.addEventListener("click", () => {
            const href = getCurrentHref();
            if (!href) return;
            if (favorites[href]) {
              delete favorites[href];
            } else {
              favorites[href] = true;
            }
            saveJson(LS_FAV, favorites);
            syncHeartButton(heartBtn);
          });
        }

        if (!toolbar.querySelector(".lg-custom-comment")) {
          const commentBtn = document.createElement("button");
          commentBtn.className = "lg-icon lg-custom-btn lg-custom-comment";
          commentBtn.textContent = "ğŸ“";
          commentBtn.title = "ãƒ¡ãƒ¢ã‚’æ›¸ã";
          toolbar.appendChild(commentBtn);
          commentBtn.addEventListener("click", () => {
            syncCommentPanel();
            commentPanel.classList.add("open");
            commentTextarea.focus();
          });
          commentTextarea.addEventListener("input", () => {
            saveCurrentComment();
          });
        }

        if (!toolbar.querySelector(".lg-custom-exif")) {
          const exifBtn = document.createElement("button");
          exifBtn.className = "lg-icon lg-custom-btn lg-custom-exif";
          exifBtn.textContent = "ğŸ“·";
          exifBtn.title = "EXIFè¡¨ç¤ºåˆ‡æ›¿";
          toolbar.appendChild(exifBtn);
          exifBtn.addEventListener("click", () => {
            exifVisible = !exifVisible;
            saveJson(LS_EXIF, exifVisible);
            syncExifVisibility();
          });
        }

        if (!toolbar.querySelector(".lg-custom-share")) {
          const shareBtn = document.createElement("button");
          shareBtn.className = "lg-icon lg-custom-btn lg-custom-share";
          shareBtn.textContent = "ğŸ”—";
          shareBtn.title = "å…±æœ‰";
          toolbar.appendChild(shareBtn);
          shareBtn.addEventListener("click", () => {
            const href = getCurrentHref() || window.location.href;
            const shareUrl = href;
            if (navigator.share) {
              navigator.share({
                title: document.title || "ãƒ•ã‚©ãƒˆã‚®ãƒ£ãƒ©ãƒªãƒ¼",
                url: shareUrl
              }).catch(()=>{});
            } else {
              // ç°¡æ˜“ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼šX / LINE / ã‚³ãƒ”ãƒ¼
              const msg = "å…±æœ‰æ–¹æ³•ã‚’é¸ã‚“ã§ãã ã•ã„ï¼š\n1: Xã«æŠ•ç¨¿\n2: LINEã§å…±æœ‰\n3: URLã‚’ã‚³ãƒ”ãƒ¼";
              const choice = window.prompt(msg, "3");
              if (choice === "1") {
                const url = "https://twitter.com/intent/tweet?url=" + encodeURIComponent(shareUrl);
                window.open(url, "_blank");
              } else if (choice === "2") {
                const url = "https://line.me/R/msg/text/?" + encodeURIComponent(shareUrl);
                window.open(url, "_blank");
              } else {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                  navigator.clipboard.writeText(shareUrl).then(()=>{
                    alert("URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
                  }).catch(()=>{
                    alert("URL: " + shareUrl);
                  });
                } else {
                  alert("URL: " + shareUrl);
                }
              }
            }
          });
        }

        if (!toolbar.querySelector(".lg-custom-slideshow")) {
          let playing = false;
          let timer = null;
          const slideBtn = document.createElement("button");
          slideBtn.className = "lg-icon lg-custom-btn lg-custom-slideshow";
          slideBtn.textContent = "â–¶";
          slideBtn.title = "ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼";
          toolbar.appendChild(slideBtn);

          slideBtn.addEventListener("click", () => {
            playing = !playing;
            if (playing) {
              slideBtn.textContent = "â¸";
              slideBtn.title = "åœæ­¢";
              timer = setInterval(() => {
                if (lgInstance) {
                  lgInstance.slideNext();
                }
              }, 3000);
            } else {
              slideBtn.textContent = "â–¶";
              slideBtn.title = "ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼";
              if (timer) {
                clearInterval(timer);
                timer = null;
              }
            }
          });

          // galleryã‚’é–‰ã˜ãŸã‚‰ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã‚‚åœæ­¢
          lgInstance.on("lgBeforeClose", () => {
            playing = false;
            if (timer) {
              clearInterval(timer);
              timer = null;
            }
            slideBtn.textContent = "â–¶";
            slideBtn.title = "ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼";
          });
        }

        if (!toolbar.querySelector(".lg-custom-favlist")) {
          const favListBtn = document.createElement("button");
          favListBtn.className = "lg-icon lg-custom-btn lg-custom-favlist";
          favListBtn.textContent = "â­";
          favListBtn.title = "ãŠæ°—ã«å…¥ã‚Šä¸€è¦§";
          toolbar.appendChild(favListBtn);
          favListBtn.addEventListener("click", () => {
            renderFavoritesOverlay();
            favOverlay.style.display = "flex";
          });
        }

        // åˆå›ã‚ªãƒ¼ãƒ—ãƒ³æ™‚ã«çŠ¶æ…‹ã‚’åŒæœŸ
        const heartBtn = toolbar.querySelector(".lg-custom-heart");
        syncHeartButton(heartBtn);
        syncCommentPanel();
        syncExifVisibility();
      });

      // ã‚¹ãƒ©ã‚¤ãƒ‰ãŒå¤‰ã‚ã‚‹ãŸã³ã«çŠ¶æ…‹æ›´æ–°
      lgInstance.on("lgAfterSlide", () => {
        const toolbar = document.querySelector(".lg-toolbar");
        if (!toolbar) return;
        const heartBtn = toolbar.querySelector(".lg-custom-heart");
        syncHeartButton(heartBtn);
        syncCommentPanel();
        syncExifVisibility();
      });

      // === fullscreen & è¦ªé€šçŸ¥ï¼ˆæ—¢å­˜æ©Ÿèƒ½ã‚’ç¶­æŒï¼‰ ===
      gallery.querySelectorAll("a.gallery-item").forEach((a) => {
        a.addEventListener("click", () => {
          const el = document.documentElement;
          if (el.requestFullscreen) el.requestFullscreen();
          else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
          else if (el.msRequestFullscreen) el.msRequestFullscreen();
        });
      });

      gallery.addEventListener("lgBeforeClose", () => {
        console.log("ğŸ“¤ å­ï¼šLG before close ç™ºç«");
        if (document.fullscreenElement) {
          document.exitFullscreen().catch(()=>{});
        }
        window.parent.postMessage({ type: "lgClosed" }, "*");
      });

      document.addEventListener("fullscreenchange", () => {
        if (!document.fullscreenElement) {
          console.log("ğŸ“¤ å­ï¼šfullscreenchangeç™ºç« â†’ è¦ªã« lgClosed ã‚’é€ä¿¡");
          try {
            if (lgInstance) lgInstance.closeGallery();
            window.parent.postMessage({ type: "lgClosed" }, "*");
          } catch(e) {}
        }
      });

    }); // imagesLoaded
  } // if(gallery)

  // === ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šï¼ˆscrollToTitle ç”¨ï¼šæ—¢å­˜ç¶­æŒï¼‰ ===
  document.addEventListener("click", (e) => {
    const a = e.target.closest("a");
    if (!a) return;

    const txt = a.textContent || "";
    const href = a.getAttribute("href") || "";

    console.log("[iframe] click anchor:", { text: txt, href });

    // 1) ã‚­ãƒã‚³åãƒšãƒ¼ã‚¸ (xxx.html)
    if (href.endsWith(".html")) {
      console.log("[iframe] send scrollToTitle (html link)");
      window.parent.postMessage({ type: "scrollToTitle" }, "*");
      return;
    }

    // 2) ã‚è¡Œã€œã‚è¡Œ
    if (/^(ã‚è¡Œ|ã‹è¡Œ|ã•è¡Œ|ãŸè¡Œ|ãªè¡Œ|ã¯è¡Œ|ã¾è¡Œ|ã‚„è¡Œ|ã‚‰è¡Œ|ã‚è¡Œ)$/.test(txt)) {
      console.log("[iframe] send scrollToTitle (aiuo link)");
      window.parent.postMessage({ type: "scrollToTitle" }, "*");
      return;
    }

    // 3) â† æˆ»ã‚‹
    if (/æˆ»ã‚‹/.test(txt)) {
      console.log("[iframe] send scrollToTitle (back)");
      window.parent.postMessage({ type: "scrollToTitle" }, "*");
      return;
    }
  });

  sendHeight();
  window.addEventListener("load", ()=>{ sendHeight(); setTimeout(sendHeight,800); setTimeout(sendHeight,2000); });
  window.addEventListener("message", e=>{ if(e.data?.type==="requestHeight") sendHeight(); });
  window.addEventListener("resize", sendHeight);
  new MutationObserver(sendHeight).observe(document.body,{childList:true,subtree:true});

});
</script>
