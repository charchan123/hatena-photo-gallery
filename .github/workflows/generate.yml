name: Build & Deploy Photo Gallery

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ ãƒªãƒã‚¸ãƒˆãƒªå–å¾—
        uses: actions/checkout@v4

      - name: ğŸ Python ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: ğŸ“¦ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆrequirements.txtï¼‰
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ğŸ”‘ ã¯ã¦ãªAPIã‚­ãƒ¼è¨­å®š
        env:
          HATENA_USER: ${{ secrets.HATENA_USER }}
          HATENA_BLOG_ID: ${{ secrets.HATENA_BLOG_ID }}
          HATENA_API_KEY: ${{ secrets.HATENA_API_KEY }}
        run: |
          echo "ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯ä¸­..."
          if [ -z "$HATENA_USER" ]; then echo 'HATENA_USER missing'; exit 1; fi
          if [ -z "$HATENA_BLOG_ID" ]; then echo 'HATENA_BLOG_ID missing'; exit 1; fi
          if [ -z "$HATENA_API_KEY" ]; then echo 'HATENA_API_KEY missing'; exit 1; fi

      - name: ğŸ— main.py å®Ÿè¡Œï¼ˆHTMLç”Ÿæˆï¼‰
        env:
          HATENA_USER: ${{ secrets.HATENA_USER }}
          HATENA_BLOG_ID: ${{ secrets.HATENA_BLOG_ID }}
          HATENA_API_KEY: ${{ secrets.HATENA_API_KEY }}
        run: |
          python main.py

      - name: ğŸ“ LightGallery ãƒ•ã‚©ãƒ«ãƒ€ã‚’ output ã«ã‚³ãƒ”ãƒ¼
        run: |
          mkdir -p output/lightgallery
          cp -r lightgallery/* output/lightgallery/

      - name: ğŸ“¤ GitHub Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: output
          branch: gh-pages
          clean: true
