<h2>Butyriboletus roseogriseusï¼Ÿ</h2><div class='gallery'><a class="gallery-item" href="https://cdn-ak.f.st-hatena.com/images/fotolife/e/exsudoporus_ruber/20250914/20250914231922.jpg" data-exthumbimage="https://cdn-ak.f.st-hatena.com/images/fotolife/e/exsudoporus_ruber/20250914/20250914231922.jpg?width=300"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/e/exsudoporus_ruber/20250914/20250914231922.jpg" alt="Butyriboletus roseogriseusï¼Ÿ" loading="lazy"></a></div>
        <div style='margin-top:40px; text-align:center;'>
            <a href='javascript:history.back()' style='text-decoration:none;color:#007acc;'>â† æˆ»ã‚‹</a>
        </div>
        <style>
html, body {
  margin: 0;
  padding: 0;
  overflow-y: hidden;
}
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background:#fafafa;
  color:#333;
  padding:16px;
  box-sizing:border-box;
}

.gallery {
  column-count: 2;
  column-gap: 10px;
  max-width: 900px;
  margin: 0 auto;
  visibility: hidden;
}
.gallery a.gallery-item{
  display: block;
  break-inside: avoid;
  margin-bottom: 10px;
  border-radius: 8px;
  overflow: hidden;
}
.gallery img {
  width: 100%;
  height: auto;
  display: block;
  cursor: zoom-in;
  transition: opacity 0.6s ease, transform 0.6s ease;
  opacity: 0;
  transform: translateY(10px);
}
.gallery img.visible {
  opacity: 1;
  transform: translateY(0);
}

@media (max-width: 480px) {
  .gallery { column-count: 1; }
}
</style>
<!-- LightGallery CSS -->
<link rel="stylesheet" href="./lightgallery/lightgallery-bundle.min.css">
<link rel="stylesheet" href="./lightgallery/lg-thumbnail.css">

<!-- LightGallery JS -->
<script src="./lightgallery/lightgallery.min.js"></script>
<script src="./lightgallery/lg-zoom.min.js"></script>
<script src="./lightgallery/lg-thumbnail.min.js"></script>
<script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  // ========== è¦ªã¸é«˜ã•é€šçŸ¥ ==========
  function sendHeight() {
    const height = document.documentElement.scrollHeight;
    window.parent.postMessage({ type: "setHeight", height }, "*");
  }

  const gallery = document.querySelector(".gallery");
  if (!gallery) {
    console.warn("âš  .gallery ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
    sendHeight();
    return;
  }

  // ========== ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ ==========
  const fadeObs = new IntersectionObserver((entries) => {
    entries.forEach((e) => {
      if (e.isIntersecting) {
        e.target.classList.add("visible");
        fadeObs.unobserve(e.target);
      }
    });
  }, { threshold: 0.1 });

  gallery.querySelectorAll("img").forEach((img) => fadeObs.observe(img));

  imagesLoaded(gallery, () => {
    console.log("âœ… imagesLoaded å®Œäº†");
    gallery.style.visibility = "visible";
    sendHeight();

    // ========== LightGallery åˆæœŸåŒ–(v2) ==========
    const lg = lightGallery(gallery, {
      selector: "a.gallery-item",
      plugins: [lgZoom, lgThumbnail],
      speed: 400,
      download: false,
      zoom: true,
      thumbnail: true,
    });

    console.log("âœ… lg ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹:", lg, "typeof lg.on =", typeof lg.on);

    // ---------- ã‚µãƒ ãƒã‚¤ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ ----------
    gallery.querySelectorAll("a.gallery-item").forEach((a) => {
      a.addEventListener("click", () => {
        const el = document.documentElement;
        if (el.requestFullscreen) el.requestFullscreen();
        else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        else if (el.msRequestFullscreen) el.msRequestFullscreen();
      });
    });

    // ---------- é–‰ã˜ã‚‹ç›´å‰ï¼ˆãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è§£é™¤ï¼‹è¦ªã¸é€šçŸ¥ï¼‰ ----------
    gallery.addEventListener("lgBeforeClose", () => {
      console.log("ğŸ“¤ å­ï¼šLG before close ç™ºç«");
      if (document.fullscreenElement) {
        document.exitFullscreen().catch(() => {});
      }
      window.parent.postMessage({ type: "lgClosed" }, "*");
    });

    // ---------- ESC ã§ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è§£é™¤ã•ã‚ŒãŸã‚‰ LG ã‚’é–‰ã˜ã¦è¦ªã«é€šçŸ¥ ----------
    document.addEventListener("fullscreenchange", () => {
      if (!document.fullscreenElement) {
        console.log("ğŸ“¤ å­ï¼šfullscreenchangeç™ºç« â†’ è¦ªã« lgClosed ã‚’é€ä¿¡");
        try {
          lg.closeGallery();
          window.parent.postMessage({ type: "lgClosed" }, "*");
        } catch (e) {
          console.error("lg.closeGallery() ã§ã‚¨ãƒ©ãƒ¼:", e);
        }
      }
    });

    // ========== â˜… ã“ã“ãŒ EXIF å‘¨ã‚Šã®æœ¬ä½“ â˜… ==========
    if (typeof lg.on !== "function") {
      console.error("âŒ lg.on ãŒé–¢æ•°ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚LightGallery v2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚");
    } else {
      lg.on("lgAfterSlide", (event) => {
        console.log("ğŸ“¸ lgAfterSlide ç™ºç«:", event);

        const detail = event.detail || {};
        const index = detail.index;
        const instance = detail.instance || lg;

        if (index == null || !instance || !instance.galleryItems) {
          console.warn("âš  lgAfterSlide: index ã¾ãŸã¯ galleryItems ãŒä¸æ­£", detail);
          return;
        }

        const item = instance.galleryItems[index];
        if (!item) {
          console.warn("âš  lgAfterSlide: galleryItems[" + index + "] ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
          return;
        }

        const imgSrc = item.src;
        console.log("ğŸ”— å¯¾è±¡ç”»åƒ src:", imgSrc);

        const captionEl = document.querySelector(".lg-sub-html");
        if (!captionEl) {
          console.warn("âš  .lg-sub-html ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
          return;
        }

        // æ—¢å­˜ã®ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ï¼ˆã‚­ãƒã‚³åãªã©ï¼‰
        const baseCaption = item.subHtml || captionEl.innerHTML || "";

        captionEl.innerHTML = "EXIF èª­ã¿è¾¼ã¿ä¸­â€¦<br>" + baseCaption;

        // ç”»åƒã‚’åˆ¥ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ãƒ­ãƒ¼ãƒ‰ã—ã¦ EXIF èª­ã¿å–ã‚Š
        const img = new Image();
        img.crossOrigin = "Anonymous";
        img.src = imgSrc;

        img.onload = function () {
          console.log("ğŸ–¼ ç”»åƒãƒ­ãƒ¼ãƒ‰å®Œäº†ã€‚EXIF å–å¾—é–‹å§‹");
          try {
            EXIF.getData(img, function () {
              console.log("ğŸ“¥ EXIF ç”Ÿãƒ‡ãƒ¼ã‚¿:", this.exifdata);

              const model = EXIF.getTag(this, "Model") || "";
              const lens = EXIF.getTag(this, "LensModel") || "";
              const iso = EXIF.getTag(this, "ISO") || "";
              const fnum = EXIF.getTag(this, "FNumber");
              const f = fnum ? "f/" + fnum : "";
              const exposure = EXIF.getTag(this, "ExposureTime") || "";
              const focalLen = EXIF.getTag(this, "FocalLength");
              const focal = focalLen ? focalLen + "mm" : "";
              const date = EXIF.getTag(this, "DateTimeOriginal") || "";

              const exifHTML = `
                <div class="exif-box">
                  <strong>æ’®å½±æƒ…å ±</strong><br>
                  ${model ? `ã‚«ãƒ¡ãƒ©ï¼š${model}<br>` : ""}
                  ${lens ? `ãƒ¬ãƒ³ã‚ºï¼š${lens}<br>` : ""}
                  ${iso ? `ISOï¼š${iso}<br>` : ""}
                  ${f ? `çµã‚Šï¼š${f}<br>` : ""}
                  ${exposure ? `ã‚·ãƒ£ãƒƒã‚¿ãƒ¼é€Ÿåº¦ï¼š${exposure}<br>` : ""}
                  ${focal ? `ç„¦ç‚¹è·é›¢ï¼š${focal}<br>` : ""}
                  ${date ? `æ’®å½±æ—¥ï¼š${date}<br>` : ""}
                </div>
              `;

              console.log("âœ… EXIF æ•´å½¢å¾Œ:", { model, lens, iso, f, exposure, focal, date });

              captionEl.innerHTML = exifHTML + baseCaption;
            });
          } catch (err) {
            console.error("âŒ EXIF èª­ã¿å–ã‚Šä¸­ã«ã‚¨ãƒ©ãƒ¼:", err);
            captionEl.innerHTML = "EXIF ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ<br>" + baseCaption;
          }
        };

        img.onerror = function () {
          console.error("âŒ EXIF ç”¨ç”»åƒã®ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—:", imgSrc);
          captionEl.innerHTML = "EXIF ç”»åƒã®èª­ã¿è¾¼ã¿å¤±æ•—<br>" + baseCaption;
        };
      });
    }

    // ========== iframe è¦ªã«ã€Œã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã€ã¨ä¼ãˆã‚‹ ==========
    document.addEventListener("click", (e) => {
      const a = e.target.closest("a");
      if (!a) return;

      const txt = a.textContent || "";

      // äº”åéŸ³ãƒªãƒ³ã‚¯ï¼ˆã‚è¡Œã€œã‚è¡Œï¼‰
      if (/ã‚è¡Œ|ã‹è¡Œ|ã•è¡Œ|ãŸè¡Œ|ãªè¡Œ|ã¯è¡Œ|ã¾è¡Œ|ã‚„è¡Œ|ã‚‰è¡Œ|ã‚è¡Œ/.test(txt)) {
        window.parent.postMessage({ type: "scrollToIframeTop" }, "*");
        return;
      }

      // ãã®ã“å€‹åˆ¥ãƒªãƒ³ã‚¯ï¼ˆã€œ.htmlï¼‰
      if (a.href && a.href.endsWith(".html")) {
        window.parent.postMessage({ type: "scrollToIframeTop" }, "*");
        return;
      }

      // æˆ»ã‚‹ãƒªãƒ³ã‚¯
      if (/æˆ»ã‚‹/.test(txt)) {
        window.parent.postMessage({ type: "scrollToIframeTop" }, "*");
        return;
      }
    });

  }); // imagesLoaded end

  // åˆæœŸé«˜ã•é€šçŸ¥
  sendHeight();
  window.addEventListener("load", () => {
    sendHeight();
    setTimeout(sendHeight, 800);
    setTimeout(sendHeight, 2000);
  });
  window.addEventListener("message", (e) => {
    if (e.data && e.data.type === "requestHeight") sendHeight();
  });
  window.addEventListener("resize", sendHeight);
  new MutationObserver(sendHeight).observe(document.body, { childList: true, subtree: true });
});
</script>

<!-- EXIF èª­ã¿å–ã‚Šãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
<script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
