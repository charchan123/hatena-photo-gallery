<div class='gallery'><a class="gallery-item" href="https://cdn-ak.f.st-hatena.com/images/fotolife/e/exsudoporus_ruber/20250929/20250929221147.jpg" data-exthumbimage="https://cdn-ak.f.st-hatena.com/images/fotolife/e/exsudoporus_ruber/20250929/20250929221147.jpg?width=300" data-sub-html="
    &lt;div style=&#x27;text-align:center;&#x27;&gt;
        &lt;div style=&#x27;font-weight:bold; font-size:1.2em; margin-bottom:6px;&#x27;&gt;ã‚¯ãƒ­ã‚¢ãƒ¯ã‚¿ã‚±ã®ä»²é–“ï¼Ÿ&lt;/div&gt;
        &lt;div style=&#x27;font-size:0.9em; line-height:1.4;&#x27;&gt;ã‚«ãƒ¡ãƒ©ï¼šDC-G9M2 | ãƒ¬ãƒ³ã‚ºï¼šOLYMPUS M.12-40mm F2.8 | ISOï¼š320 | çµã‚Šï¼šf/22.0 | ã‚·ãƒ£ãƒƒã‚¿ãƒ¼é€Ÿåº¦ï¼š1/2 | ç„¦ç‚¹è·é›¢ï¼š25mm | æ’®å½±æ—¥ï¼š2025/09/28&lt;/div&gt;
    &lt;/div&gt;
    "><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/e/exsudoporus_ruber/20250929/20250929221147.jpg" alt="ã‚¯ãƒ­ã‚¢ãƒ¯ã‚¿ã‚±ã®ä»²é–“ï¼Ÿ" loading="lazy"></a></div>
        <div style='margin-top:40px; text-align:center;'>
            <a href='javascript:history.back()' style='text-decoration:none;color:#007acc;'>â† æˆ»ã‚‹</a>
        </div>
        <style>
html, body {
  margin: 0;
  padding: 0;
  overflow-y: hidden;
}
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background:#fafafa;
  color:#333;
  padding:16px;
  box-sizing:border-box;
}

.gallery {
  column-count: 2;
  column-gap: 10px;
  max-width: 900px;
  margin: 0 auto;
  visibility: hidden;
}
.gallery a.gallery-item{
  display: block;
  break-inside: avoid;
  margin-bottom: 10px;
  border-radius: 8px;
  overflow: hidden;
}
.gallery img {
  width: 100%;
  height: auto;
  display: block;
  cursor: zoom-in;
  transition: opacity 0.6s ease, transform 0.6s ease;
  opacity: 0;
  transform: translateY(10px);
}
.gallery img.visible {
  opacity: 1;
  transform: translateY(0);
}

@media (max-width: 480px) {
  .gallery { column-count: 1; }
}
</style>
<link rel="stylesheet" href="./lightgallery/lightgallery-bundle.min.css">
<link rel="stylesheet" href="./lightgallery/lg-thumbnail.css">

<script src="./lightgallery/lightgallery.min.js"></script>
<script src="./lightgallery/lg-zoom.min.js"></script>
<script src="./lightgallery/lg-thumbnail.min.js"></script>
<script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {

  function sendHeight() {
    const height = document.documentElement.scrollHeight;
    window.parent.postMessage({ type:"setHeight", height }, "*");
  }

  // ===== å…±é€šçŠ¶æ…‹ =====
  const FAVORITES_KEY = "mushroomFavorites";
  const COMMENTS_KEY  = "mushroomComments";

  let lg = null;                 // LightGalleryã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
  let autoPlayTimer = null;      // è‡ªå‹•å†ç”Ÿç”¨ã‚¿ã‚¤ãƒãƒ¼
  let isAutoPlaying = false;     // è‡ªå‹•å†ç”Ÿãƒ•ãƒ©ã‚°
  let isFavoritesView = false;   // ã€ŒãŠæ°—ã«å…¥ã‚Šã ã‘è¡¨ç¤ºã€ãƒ¢ãƒ¼ãƒ‰
  let currentSrc = "";           // ç¾åœ¨è¡¨ç¤ºä¸­ã®ç”»åƒURL

  let btnFav = null;
  let btnComment = null;
  let btnShare = null;
  let btnAutoplay = null;
  let btnFavList = null;

  let originalItems = [];        // { src, html } ã®é…åˆ—ã¨ã—ã¦å…ƒã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚’ä¿æŒ

  // ===== LocalStorage ãƒ˜ãƒ«ãƒ‘ =====
  function loadJson(key) {
    try {
      const raw = localStorage.getItem(key);
      if (!raw) return {};
      const obj = JSON.parse(raw);
      return obj && typeof obj === "object" ? obj : {};
    } catch(e) {
      console.warn("LocalStorage parse error:", key, e);
      return {};
    }
  }

  function saveJson(key, obj) {
    try {
      localStorage.setItem(key, JSON.stringify(obj || {}));
    } catch(e) {
      console.warn("LocalStorage save error:", key, e);
    }
  }

  function getFavoritesMap() {
    return loadJson(FAVORITES_KEY);
  }
  function setFavorite(src, on) {
    if (!src) return;
    const map = getFavoritesMap();
    if (on) map[src] = true;
    else delete map[src];
    saveJson(FAVORITES_KEY, map);
  }
  function isFavorite(src) {
    const map = getFavoritesMap();
    return !!map[src];
  }

  function getCommentsMap() {
    return loadJson(COMMENTS_KEY);
  }
  function setComment(src, text) {
    if (!src) return;
    const map = getCommentsMap();
    const t = (text || "").trim();
    if (t) map[src] = t;
    else delete map[src];
    saveJson(COMMENTS_KEY, map);
  }
  function getComment(src) {
    const map = getCommentsMap();
    return map[src] || "";
  }

  // ===== è‡ªå‹•å†ç”Ÿ =====
  function stopAutoPlay() {
    if (autoPlayTimer) {
      clearInterval(autoPlayTimer);
      autoPlayTimer = null;
    }
    isAutoPlaying = false;
    if (btnAutoplay) btnAutoplay.classList.remove("playing");
  }

  function startAutoPlay() {
    stopAutoPlay();
    if (!lg) return;
    isAutoPlaying = true;
    if (btnAutoplay) btnAutoplay.classList.add("playing");
    autoPlayTimer = setInterval(() => {
      try {
        lg.slideNext();
      } catch(e) {
        console.warn("slideNext error", e);
        stopAutoPlay();
      }
    }, 3000); // 3ç§’ã”ã¨ã«æ¬¡ã¸
  }

  // ===== ç¾åœ¨ã‚¹ãƒ©ã‚¤ãƒ‰ã® src å–å¾— =====
  function getSrcFromDetail(detail) {
    try {
      const index = detail.index;
      const instance = detail.instance;
      const item = instance.galleryItems[index];
      return item && item.src ? item.src : "";
    } catch(e) {
      return "";
    }
  }

  // ===== UIåŒæœŸï¼ˆãƒãƒ¼ãƒˆã¨ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¤ã‚³ãƒ³ï¼‰ =====
  function syncUIForCurrentImage() {
    if (!currentSrc) return;

    // ãŠæ°—ã«å…¥ã‚Š
    if (btnFav) {
      if (isFavorite(currentSrc)) btnFav.classList.add("active");
      else btnFav.classList.remove("active");
    }

    // ã‚³ãƒ¡ãƒ³ãƒˆå­˜åœ¨ãƒ•ãƒ©ã‚°
    if (btnComment) {
      if (getComment(currentSrc)) btnComment.classList.add("has-comment");
      else btnComment.classList.remove("has-comment");
    }

    // ã‚³ãƒ¡ãƒ³ãƒˆãƒ‘ãƒãƒ«ãŒé–‹ã„ã¦ã„ãŸã‚‰ãƒ†ã‚­ã‚¹ãƒˆã‚‚æ›´æ–°
    const panel = document.getElementById("comment-panel");
    const ta = document.getElementById("comment-text");
    if (panel && ta && panel.classList.contains("open")) {
      ta.value = getComment(currentSrc);
    }
  }

  // ===== ã‚³ãƒ¡ãƒ³ãƒˆãƒ‘ãƒãƒ« & ã‚·ã‚§ã‚¢ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’äº‹å‰ã«ç”¨æ„ =====
  (function setupSideUI() {
    // ã‚³ãƒ¡ãƒ³ãƒˆãƒ‘ãƒãƒ«
    const panelHtml = `
      <div id="comment-panel">
        <div class="cp-header">ã‚³ãƒ¡ãƒ³ãƒˆ</div>
        <textarea id="comment-text" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ãâ€¦" ></textarea>
        <button id="cp-save">ä¿å­˜</button>
      </div>
    `;
    document.body.insertAdjacentHTML("beforeend", panelHtml);

    // ã‚·ã‚§ã‚¢ãƒ¡ãƒ‹ãƒ¥ãƒ¼
    const shareHtml = `
      <div id="share-menu">
        <div class="sm-inner">
          <div class="sm-title">ã“ã®å†™çœŸã‚’ã‚·ã‚§ã‚¢</div>
          <button id="sm-x">Xã«æŠ•ç¨¿</button>
          <button id="sm-line">LINEã§ã‚·ã‚§ã‚¢</button>
          <button id="sm-copy">URLã‚’ã‚³ãƒ”ãƒ¼</button>
          <button id="sm-close">é–‰ã˜ã‚‹</button>
        </div>
      </div>
    `;
    document.body.insertAdjacentHTML("beforeend", shareHtml);
  })();

  // ===== ã‚³ãƒ¡ãƒ³ãƒˆãƒ‘ãƒãƒ«ã®ã‚¤ãƒ™ãƒ³ãƒˆ =====
  function toggleCommentPanel(open) {
    const panel = document.getElementById("comment-panel");
    const ta = document.getElementById("comment-text");
    if (!panel || !ta) return;
    if (typeof open === "boolean") {
      if (open) panel.classList.add("open");
      else panel.classList.remove("open");
    } else {
      panel.classList.toggle("open");
    }
    if (panel.classList.contains("open")) {
      ta.value = getComment(currentSrc);
      ta.focus();
    }
  }

  document.addEventListener("click", (e) => {
    // ã‚³ãƒ¡ãƒ³ãƒˆä¿å­˜ãƒœã‚¿ãƒ³
    if (e.target && e.target.id === "cp-save") {
      const ta = document.getElementById("comment-text");
      if (!ta) return;
      setComment(currentSrc, ta.value);
      syncUIForCurrentImage();
      alert("ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ");
    }
  });

  // ===== ã‚·ã‚§ã‚¢ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆ =====
  let lastShareUrl = "";

  function openShareMenu(url) {
    lastShareUrl = url || window.location.href;
    const menu = document.getElementById("share-menu");
    if (menu) menu.classList.add("open");
  }
  function closeShareMenu() {
    const menu = document.getElementById("share-menu");
    if (menu) menu.classList.remove("open");
  }

  document.addEventListener("click", (e) => {
    const id = e.target && e.target.id;
    if (!id) return;

    if (id === "sm-close") {
      closeShareMenu();
    } else if (id === "sm-x") {
      const text = encodeURIComponent("ãã®ã“å†™çœŸã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚ˆã‚Š");
      const url  = encodeURIComponent(lastShareUrl || window.location.href);
      window.open("https://twitter.com/intent/tweet?text=" + text + "&url=" + url, "_blank");
    } else if (id === "sm-line") {
      const url  = encodeURIComponent(lastShareUrl || window.location.href);
      window.open("https://social-plugins.line.me/lineit/share?url=" + url, "_blank");
    } else if (id === "sm-copy") {
      const targetUrl = lastShareUrl || window.location.href;
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(targetUrl).then(() => {
          alert("URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
        }).catch(() => {
          alert("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã§ãã¾ã›ã‚“ã§ã—ãŸ");
        });
      } else {
        alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ã‚³ãƒ”ãƒ¼ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“");
      }
    }
  });

  // ===== ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¤ã‚³ãƒ³ã®CSS =====
  (function injectCustomCss() {
    const css = document.createElement("style");
    css.textContent = `
      /* toolbar å…±é€šãƒœã‚¿ãƒ³ */
      .lg-custom-btn {
        width:20px;
        height:20px;
        background-color:#ddd;
        border:none;
        border-radius:4px;
        margin-left:8px;
        padding:0;
        font-size:0 !important;
        cursor:pointer;
      }
      .lg-custom-btn::before {
        display:block;
        width:100%;
        height:100%;
        line-height:20px;
        text-align:center;
        font-size:16px;
      }
      /* å„ã‚¢ã‚¤ã‚³ãƒ³ */
      #lg-btn-autoplay::before { content:"â–¶"; }
      #lg-btn-autoplay.playing::before { content:"â¸"; }

      #lg-btn-share::before { content:"â‡ª"; }

      #lg-btn-fav::before { content:"â™¡"; color:#fff; }
      #lg-btn-fav.active::before { content:"â¤"; color:#e60033; }

      #lg-btn-comment::before { content:"âœ"; }
      #lg-btn-comment.has-comment::before { content:"âœ"; color:#007acc; }

      #lg-btn-favlist::before { content:"â˜…"; }
      #lg-btn-favlist.active::before { content:"â˜…"; color:#ffbf00; }

      /* ã‚³ãƒ¡ãƒ³ãƒˆãƒ‘ãƒãƒ« */
      #comment-panel {
        position:fixed;
        top:0;
        right:-260px;
        width:260px;
        height:100%;
        background:#fafafa;
        border-left:2px solid #ccc;
        box-shadow:-2px 0 6px rgba(0,0,0,0.15);
        padding:10px;
        box-sizing:border-box;
        transition:right 0.25s ease-out;
        z-index:99999;
        display:flex;
        flex-direction:column;
        gap:8px;
      }
      #comment-panel.open {
        right:0;
      }
      #comment-panel .cp-header {
        font-weight:bold;
        margin-bottom:4px;
      }
      #comment-text {
        flex:1;
        width:100%;
        resize:vertical;
        box-sizing:border-box;
      }
      #cp-save {
        width:100%;
      }

      /* ã‚·ã‚§ã‚¢ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
      #share-menu {
        position:fixed;
        inset:0;
        background:rgba(0,0,0,0.4);
        display:none;
        align-items:center;
        justify-content:center;
        z-index:99998;
      }
      #share-menu.open {
        display:flex;
      }
      #share-menu .sm-inner {
        background:#fff;
        padding:16px;
        border-radius:8px;
        box-shadow:0 2px 8px rgba(0,0,0,0.3);
        display:flex;
        flex-direction:column;
        gap:8px;
        min-width:200px;
      }
      #share-menu .sm-title {
        font-weight:bold;
        margin-bottom:4px;
      }
      #share-menu button {
        padding:6px 8px;
      }
    `;
    document.head.appendChild(css);
  })();

  const gallery = document.querySelector(".gallery");
  if (gallery) {
    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ç”¨ã‚ªãƒ–ã‚¶ãƒ¼ãƒ
    const fadeObs = new IntersectionObserver(entries=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          e.target.classList.add("visible");
          fadeObs.unobserve(e.target);
        }
      });
    }, {threshold:0.1});

    gallery.querySelectorAll("img").forEach(img=>fadeObs.observe(img));

    // å…ƒã‚®ãƒ£ãƒ©ãƒªãƒ¼æ§‹æˆã‚’è¨˜éŒ²ï¼ˆãŠæ°—ã«å…¥ã‚Šåˆ‡æ›¿ç”¨ï¼‰
    const links = Array.from(gallery.querySelectorAll("a.gallery-item"));
    originalItems = links.map(a => {
      const src = a.getAttribute("href") || (a.querySelector("img")?.src || "");
      return { src, html: a.outerHTML };
    });

    // ===== LightGallery åˆæœŸåŒ–é–¢æ•° =====
    function initLightGallery() {
      // æ—¢å­˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚ã‚Œã°ç ´æ£„
      if (lg) {
        try { lg.destroy(true); } catch(e) {}
        lg = null;
      }

      lg = lightGallery(gallery, {
        selector: 'a.gallery-item',
        plugins: [lgZoom, lgThumbnail],
        speed: 400,
        download: false,
        zoom: true,
        thumbnail: true
      });

      setupLgEnhancements(lg);
    }

    // ===== toolbar æ‹¡å¼µãªã© =====
    function setupLgEnhancements(instance) {
      // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‚ªãƒ¼ãƒ—ãƒ³æ™‚ï¼štoolbarãƒœã‚¿ãƒ³ç”Ÿæˆ
      instance.on("lgAfterOpen", (event) => {
        const toolbar = document.querySelector(".lg-toolbar");
        if (!toolbar) return;

        // é‡è¤‡ç”Ÿæˆé˜²æ­¢
        if (toolbar.dataset.customAppended === "1") return;
        toolbar.dataset.customAppended = "1";

        function addBtn(id, title) {
          const btn = document.createElement("button");
          btn.id = id;
          btn.className = "lg-custom-btn";
          btn.title = title;
          toolbar.appendChild(btn);
          return btn;
        }

        btnAutoplay = addBtn("lg-btn-autoplay", "ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼å†ç”Ÿ/ä¸€æ™‚åœæ­¢");
        btnShare    = addBtn("lg-btn-share",    "ã‚·ã‚§ã‚¢");
        btnFav      = addBtn("lg-btn-fav",      "ãŠæ°—ã«å…¥ã‚Š");
        btnComment  = addBtn("lg-btn-comment",  "ã‚³ãƒ¡ãƒ³ãƒˆ");
        btnFavList  = addBtn("lg-btn-favlist",  "ãŠæ°—ã«å…¥ã‚Šã ã‘è¡¨ç¤º");

        // ---- å„ãƒœã‚¿ãƒ³ã®å‹•ã ----

        // â–¶ / â¸ è‡ªå‹•å†ç”Ÿ
        btnAutoplay.addEventListener("click", () => {
          if (isAutoPlaying) {
            stopAutoPlay();
          } else {
            startAutoPlay();
          }
        });

        // ğŸ”— ã‚·ã‚§ã‚¢
        btnShare.addEventListener("click", () => {
          const urlToShare = currentSrc || window.location.href;
          openShareMenu(urlToShare);
        });

        // â¤ï¸ ãŠæ°—ã«å…¥ã‚Š
        btnFav.addEventListener("click", () => {
          if (!currentSrc) return;
          const now = !isFavorite(currentSrc);
          setFavorite(currentSrc, now);
          syncUIForCurrentImage();
        });

        // ğŸ“ ã‚³ãƒ¡ãƒ³ãƒˆ
        btnComment.addEventListener("click", () => {
          toggleCommentPanel();
        });

        // â­ ãŠæ°—ã«å…¥ã‚Šä¸€è¦§
        btnFavList.addEventListener("click", () => {
          const map = getFavoritesMap();
          const hasFav = Object.keys(map).length > 0;
          if (!isFavoritesView && !hasFav) {
            alert("ãŠæ°—ã«å…¥ã‚ŠãŒã¾ã ã‚ã‚Šã¾ã›ã‚“");
            return;
          }

          isFavoritesView = !isFavoritesView;
          if (btnFavList) {
            if (isFavoritesView) btnFavList.classList.add("active");
            else btnFavList.classList.remove("active");
          }

          // ã‚®ãƒ£ãƒ©ãƒªãƒ¼å†æ§‹ç¯‰
          rebuildGalleryForFavorites(isFavoritesView);
          // é«˜ã•å†è¨ˆæ¸¬
          sendHeight();
        });

        // æœ€åˆã«é–‹ã„ãŸæ™‚ç‚¹ã® src ã«åˆã‚ã›ã¦UIåæ˜ 
        currentSrc = getSrcFromDetail(event.detail) || currentSrc;
        syncUIForCurrentImage();
      });

      // ã‚¹ãƒ©ã‚¤ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ™‚ï¼šcurrentSrcæ›´æ–° & UIåŒæœŸ
      instance.on("lgAfterSlide", (event) => {
        currentSrc = getSrcFromDetail(event.detail) || currentSrc;
        syncUIForCurrentImage();
      });
    }

    // ===== ãŠæ°—ã«å…¥ã‚Šãƒ¢ãƒ¼ãƒ‰ã§ã‚®ãƒ£ãƒ©ãƒªãƒ¼å†æ§‹ç¯‰ =====
    function rebuildGalleryForFavorites(onlyFavorites) {
      // æ—¢å­˜LGç ´æ£„ & è‡ªå‹•å†ç”Ÿåœæ­¢
      stopAutoPlay();
      if (lg) {
        try { lg.destroy(true); } catch(e) {}
        lg = null;
      }

      if (!onlyFavorites) {
        // å…¨ä»¶è¡¨ç¤ºã«æˆ»ã™
        gallery.innerHTML = originalItems.map(it => it.html).join("");
      } else {
        const favMap = getFavoritesMap();
        const filtered = originalItems.filter(it => favMap[it.src]);
        if (!filtered.length) {
          // å¿µã®ãŸã‚ã‚¬ãƒ¼ãƒ‰
          gallery.innerHTML = originalItems.map(it => it.html).join("");
          isFavoritesView = false;
          if (btnFavList) btnFavList.classList.remove("active");
        } else {
          gallery.innerHTML = filtered.map(it => it.html).join("");
        }
      }

      // ç”»åƒã®ãƒ•ã‚§ãƒ¼ãƒ‰è¦³æ¸¬ã‚’å†ã‚»ãƒƒãƒˆï¼ˆæœ€ä½é™ï¼‰
      gallery.querySelectorAll("img").forEach(img=>fadeObs.observe(img));

      // æ–°ã—ã„DOMã§ LightGallery å†åˆæœŸåŒ–
      initLightGallery();
    }

    // ===== imagesLoaded å¾Œã« LightGallery èµ·å‹• =====
    imagesLoaded(gallery, () => {
      gallery.style.visibility="visible";
      sendHeight();

      initLightGallery();

      /* ==================================
         â‘  ã‚µãƒ ãƒã‚¤ãƒ«ã‚¯ãƒªãƒƒã‚¯æ™‚ã«
            å¼·åˆ¶ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ç™ºå‹•
      =================================== */
      gallery.querySelectorAll("a.gallery-item").forEach((a) => {
        a.addEventListener("click", () => {
          const el = document.documentElement;

          if (el.requestFullscreen) el.requestFullscreen();
          else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
          else if (el.msRequestFullscreen) el.msRequestFullscreen();
        });
      });

      /* ==================================
         â‘¡ v2ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆé–‰ã˜ã‚‹å‰ï¼‰
      =================================== */
      gallery.addEventListener("lgBeforeClose", () => {
        console.log("ğŸ“¤ å­ï¼šLG before close ç™ºç«");
        if (document.fullscreenElement) {
          document.exitFullscreen().catch(()=>{});
        }
        // è‡ªå‹•å†ç”Ÿã‚‚æ­¢ã‚ã‚‹
        stopAutoPlay();
        window.parent.postMessage({ type: "lgClosed" }, "*");
      });

      /* ==================================
         â‘¢ ESC â†’ ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è§£é™¤ â†’ è¦ªã¸é€šçŸ¥
      =================================== */
      document.addEventListener("fullscreenchange", () => {
        if (!document.fullscreenElement) {
          console.log("ğŸ“¤ å­ï¼šfullscreenchangeç™ºç« â†’ è¦ªã« lgClosed ã‚’é€ä¿¡");
          try {
            if (lg) lg.closeGallery();
            stopAutoPlay();
            window.parent.postMessage({ type: "lgClosed" }, "*");
          } catch(e) {}
        }
      });
    });
  }

  /* ===========================================
       â˜… ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šã¯ gallery ã®å¤–ã¸ç§»å‹•
       â†’ å…¨ãƒšãƒ¼ã‚¸ã§ scrollToTitle ã‚’é€ä¿¡ã§ãã‚‹
  ============================================ */
  document.addEventListener("click", (e) => {
    const a = e.target.closest("a");
    if (!a) return;

    const txt = a.textContent || "";
    const href = a.getAttribute("href") || "";

    console.log("[iframe] click anchor:", { text: txt, href });

    // 1) ã‚­ãƒã‚³åãƒšãƒ¼ã‚¸ (xxx.html)
    if (href.endsWith(".html")) {
      console.log("[iframe] send scrollToTitle (html link)");
      window.parent.postMessage({ type: "scrollToTitle" }, "*");
      return;
    }

    // 2) ã‚è¡Œã€œã‚è¡Œ
    if (/^(ã‚è¡Œ|ã‹è¡Œ|ã•è¡Œ|ãŸè¡Œ|ãªè¡Œ|ã¯è¡Œ|ã¾è¡Œ|ã‚„è¡Œ|ã‚‰è¡Œ|ã‚è¡Œ)$/.test(txt)) {
      console.log("[iframe] send scrollToTitle (aiuo link)");
      window.parent.postMessage({ type: "scrollToTitle" }, "*");
      return;
    }

    // 3) â† æˆ»ã‚‹
    if (/æˆ»ã‚‹/.test(txt)) {
      console.log("[iframe] send scrollToTitle (back)");
      window.parent.postMessage({ type: "scrollToTitle" }, "*");
      return;
    }
  });

  sendHeight();
  window.addEventListener("load", ()=>{ sendHeight(); setTimeout(sendHeight,800); setTimeout(sendHeight,2000); });
  window.addEventListener("message", e=>{ if(e.data?.type==="requestHeight") sendHeight(); });
  window.addEventListener("resize", sendHeight);
  new MutationObserver(sendHeight).observe(document.body,{childList:true,subtree:true});

});
</script>
